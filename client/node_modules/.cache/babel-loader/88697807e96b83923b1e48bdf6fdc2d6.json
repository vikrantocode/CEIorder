{"ast":null,"code":"import _toConsumableArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _createForOfIteratorHelper from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'react-tagsinput/react-tagsinput.css';import axios from'axios';import TagsInput from'react-tagsinput';import{servicePath}from'../../../../constants/defaultValues';import CustomSelectInput from'../../../../components/common/CustomSelectInput';import useMousetrap from'../../../../hooks/use-mousetrap';import{Button,Modal,ModalHeader,ModalBody,ModalFooter,Input,Label,Row,Col}from'reactstrap';import{NotificationManager}from'../../../../components/common/react-notifications';import IntlMessages from'../../../../helpers/IntlMessages';import AddNewVariantModal from'./add-new-variant';import VariantListHeading from'./VariantListHeading';import Select from'react-select';import VariantPageHeadings from'./VariantPageHeadings';import VariantPageListing from'./VariantPageListing';var getIndex=function getIndex(value,arr,prop){for(var i=0;i<arr.length;i+=1){if(arr[i][prop]===value){return i;}}return-1;};var apiUrl=\"\".concat(servicePath,\"/cakes/paging\");var orderOptions=[{column:'variant',label:'Variant name'},{column:'category',label:'Category'},{column:'status',label:'Status'}];var pageSizes=[4,8,12,20];var statusOptions=[{label:'Active',value:'Active',key:0},{label:'Inactive',value:'Inactive',key:1}];var Variant=function Variant(_ref){var match=_ref.match;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),selectedOptions=_useState2[0],setSelectedOptions=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoaded=_useState4[0],setIsLoaded=_useState4[1];var _useState5=useState('thumblist'),_useState6=_slicedToArray(_useState5,2),displayMode=_useState6[0],setDisplayMode=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),currentPage=_useState8[0],setCurrentPage=_useState8[1];var _useState9=useState(8),_useState10=_slicedToArray(_useState9,2),selectedPageSize=_useState10[0],setSelectedPageSize=_useState10[1];var _useState11=useState({column:'title',label:'Variant Name'}),_useState12=_slicedToArray(_useState11,2),selectedOrderOption=_useState12[0],setSelectedOrderOption=_useState12[1];var _React$useState=React.useState({}),_React$useState2=_slicedToArray(_React$useState,2),formData=_React$useState2[0],setformData=_React$useState2[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),modalBasic=_useState14[0],setModalBasic=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),modalOpen=_useState16[0],setModalOpen=_useState16[1];var _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),totalItemCount=_useState18[0],setTotalItemCount=_useState18[1];var _useState19=useState(1),_useState20=_slicedToArray(_useState19,2),totalPage=_useState20[0],setTotalPage=_useState20[1];var _useState21=useState(''),_useState22=_slicedToArray(_useState21,2),search=_useState22[0],setSearch=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),selectedItems=_useState24[0],setSelectedItems=_useState24[1];var _useState25=useState([]),_useState26=_slicedToArray(_useState25,2),items=_useState26[0],setItems=_useState26[1];var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),lastChecked=_useState28[0],setLastChecked=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),modal=_useState30[0],setModal=_useState30[1];var _useState31=useState({}),_useState32=_slicedToArray(_useState31,2),details=_useState32[0],setDetails=_useState32[1];var _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),categories=_useState34[0],setcategories=_useState34[1];var _useState35=useState(false),_useState36=_slicedToArray(_useState35,2),change=_useState36[0],setchange=_useState36[1];var _useState37=useState(\"\"),_useState38=_slicedToArray(_useState37,2),variantId=_useState38[0],setvariantId=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),modalDelete=_useState40[0],setModalDelete=_useState40[1];var _useState41=useState([]),_useState42=_slicedToArray(_useState41,2),tags=_useState42[0],setTags=_useState42[1];var deleteMultipleModal=function deleteMultipleModal(e){setModalDelete(true);};var deleteModal=function deleteModal(e){setvariantId(e);setModalBasic(true);};useEffect(function(){setCurrentPage(1);},[selectedPageSize,selectedOrderOption]);useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:axios.get(\"/api/inventory/get-variants/1\").then(function(res){return res.data;}).then(function(data){setTotalPage(data.totalPage);setItems(data.data.map(function(x){return _objectSpread({},x);}));setSelectedItems([]);// setTotalItemCount(data.totalItem);\nsetIsLoaded(true);});case 1:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}fetchData();},[change]);// DELETE MULTIPLE VARIANTS\nvar deleteMultiple=function deleteMultiple(){axios.post(\"/api/inventory/delete-variant\",null,{params:{id:selectedItems}}).then(function(res){console.log(res.data);setchange(!change);setModalDelete(false);NotificationManager.success(res.data.success,'Success',3000,null,null,'');});};// BULK STATUS CHANGE\nvar deactivate=function deactivate(e){axios.post(\"/api/inventory/deactivate-variant\",null,{params:{id:selectedItems}}).then(function(res){if(res.data.success){setchange(!change);NotificationManager.success(res.data.success,'Success',3000,null,null,'');}});};var activate=function activate(e){axios.post(\"/api/inventory/activate-variant\",null,{params:{id:selectedItems}}).then(function(res){if(res.data.success){setchange(!change);NotificationManager.success(res.data.success,'Success',3000,null,null,'');}});};useEffect(function(){axios.get(\"/api/inventory/get-category\").then(function(res){console.log(res.data.data);var categoryList=[];var singleCategory;var _iterator=_createForOfIteratorHelper(res.data.data),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;if(i.status){singleCategory={label:i.category,value:i.category,key:i.id};categoryList.push(singleCategory);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}setcategories(categoryList);console.log(\"categories are\",categories);});},[]);// GET THE VARIANT DETAILS AND OPEN THE EDIT MODAL\nvar openModal=function openModal(e){axios.get(\"/api/inventory/variant-details\",{params:{id:e}}).then(function(res){console.log(res.data.data);setDetails(res.data.data);var selectedData=[];console.log(details);var _iterator2=_createForOfIteratorHelper(res.data.data.categories),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var i=_step2.value;var obj={label:i,value:i};selectedData.push(obj);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}setSelectedOptions(selectedData);setTags(res.data.data.attributes);setModal(true);});};//DELETE Varint HANDLER\nvar deleteVariant=function deleteVariant(e){axios.post('/api/inventory/delete-variant',null,{params:{id:variantId}}).then(function(res){setchange(!change);setModalBasic(false);NotificationManager.success(res.data.success,'Success',3000,null,null,'');});};// EDIT HANDLER\nvar edit=function edit(e){console.log(e);var data={};var selectedCategories=[];if(formData.name){data.variant=formData.name.toLowerCase();}if(formData.status){if(formData.status==\"Active\"){data.status=true;}else{data.status=false;}}if(tags){data.attributes=tags;}if(selectedOptions.length>0){var _iterator3=_createForOfIteratorHelper(selectedOptions),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var i=_step3.value;selectedCategories.push(i.value);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}data.categories=selectedCategories;}console.log(data);axios.post(\"/api/inventory/edit-variant\",data,{params:{id:e}}).then(function(res){console.log(res);if(res.data.success){setModal(false);setchange(!change);NotificationManager.success(res.data.success,'Success',3000,null,null,'');}});};var onCheckItem=function onCheckItem(event,id){if(event.target.tagName==='A'||event.target.parentElement&&event.target.parentElement.tagName==='A'){return true;}if(lastChecked===null){setLastChecked(id);}var selectedList=_toConsumableArray(selectedItems);if(selectedList.includes(id)){selectedList=selectedList.filter(function(x){return x!==id;});}else{selectedList.push(id);}setSelectedItems(selectedList);if(event.shiftKey){var newItems=_toConsumableArray(items);var start=getIndex(id,newItems,'id');var end=getIndex(lastChecked,newItems,'id');newItems=newItems.slice(Math.min(start,end),Math.max(start,end)+1);selectedItems.push.apply(selectedItems,_toConsumableArray(newItems.map(function(item){return item.id;})));selectedList=Array.from(new Set(selectedItems));setSelectedItems(selectedList);}document.activeElement.blur();return false;};var handleChangeSelectAll=function handleChangeSelectAll(isToggle){if(selectedItems.length>=items.length){if(isToggle){setSelectedItems([]);}}else{setSelectedItems(items.map(function(x){return x.id;}));}document.activeElement.blur();return false;};var changePage=function changePage(i){setCurrentPage(i);axios.get(\"/api/inventory/get-variants/\".concat(i)).then(function(res){setTotalPage(res.data.totalPage);setItems(res.data.data.map(function(x){return _objectSpread({},x);}));setSelectedItems([]);// setTotalItemCount(data.totalItem);\nsetIsLoaded(true);});};var onContextMenuClick=function onContextMenuClick(e,data){// params : (e,data,target)\nconsole.log('onContextMenuClick - selected items',selectedItems);console.log('onContextMenuClick - action : ',data.action);};var onContextMenu=function onContextMenu(e,data){var clickedProductId=data.data;if(!selectedItems.includes(clickedProductId)){setSelectedItems([clickedProductId]);}return true;};useMousetrap(['ctrl+a','command+a'],function(){handleChangeSelectAll(false);});useMousetrap(['ctrl+d','command+d'],function(){setSelectedItems([]);return false;});var startIndex=(currentPage-1)*selectedPageSize;var endIndex=currentPage*selectedPageSize;return!isLoaded?/*#__PURE__*/React.createElement(\"div\",{className:\"loading\"}):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"disable-text-selection\"},/*#__PURE__*/React.createElement(VariantPageHeadings,{deleteMultipleModal:deleteMultipleModal,activate:activate,deactivate:deactivate,heading:\"Attribute\",displayMode:displayMode,changeDisplayMode:setDisplayMode,handleChangeSelectAll:handleChangeSelectAll,changeOrderBy:function changeOrderBy(column){setSelectedOrderOption(orderOptions.find(function(x){return x.column===column;}));axios.get(\"/api/inventory/get-variants/1\",{params:{sortby:column}}).then(function(res){setItems(res.data.data.map(function(x){return _objectSpread({},x);}));setSelectedItems([]);setIsLoaded(true);});},changePageSize:setSelectedPageSize,selectedPageSize:selectedPageSize,totalItemCount:totalItemCount,selectedOrderOption:selectedOrderOption,match:match,startIndex:startIndex,endIndex:endIndex,selectedItemsLength:selectedItems?selectedItems.length:0,itemsLength:items?items.length:0,onSearchKey:function onSearchKey(e){if(e.key==='Enter'){setSearch(e.target.value.toLowerCase());axios.get(\"/api/inventory/get-variants/1\",{params:{search:e.target.value.toLowerCase()}}).then(function(res){setItems(res.data.data.map(function(x){return _objectSpread({},x);}));setSelectedItems([]);// setTotalItemCount(res.data.totalItem);\nsetIsLoaded(true);});}},orderOptions:orderOptions,pageSizes:pageSizes,toggleModal:function toggleModal(){return setModalOpen(!modalOpen);}}),/*#__PURE__*/React.createElement(AddNewVariantModal,{change:change,setchange:setchange,modalOpen:modalOpen,toggleModal:function toggleModal(){return setModalOpen(!modalOpen);},categories:categories}),items.length==0?\"\":/*#__PURE__*/React.createElement(VariantListHeading,{selectedItemsLength:selectedItems?selectedItems.length:0,handleChangeSelectAll:handleChangeSelectAll,itemsLength:items?items.length:0}),items.length==0?/*#__PURE__*/React.createElement(\"h3\",null,\"No Records Found\"):/*#__PURE__*/React.createElement(VariantPageListing,{items:items,deleteModal:deleteModal,openModal:openModal,displayMode:displayMode,selectedItems:selectedItems,onCheckItem:onCheckItem,currentPage:currentPage,totalPage:totalPage,onContextMenuClick:onContextMenuClick,onContextMenu:onContextMenu,onChangePage:changePage}),/*#__PURE__*/React.createElement(Modal,{isOpen:modal,toggle:function toggle(){return setModal(!modal);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Edit\"})),/*#__PURE__*/React.createElement(ModalBody,null,/*#__PURE__*/React.createElement(Row,{className:\"mt-3\"},/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(Label,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Attribute Name\"})),/*#__PURE__*/React.createElement(Input,{onChange:function onChange(e){setformData(_objectSpread(_objectSpread({},formData),{},{name:e.target.value}));},defaultValue:details.variant})),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(Label,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Attribute Values\"})),/*#__PURE__*/React.createElement(TagsInput,{value:tags,onChange:function onChange(val){return setTags(val);},inputProps:{placeholder:''}}))),/*#__PURE__*/React.createElement(Row,{className:\"mt-3\"},/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(\"label\",null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Select Category\"})),/*#__PURE__*/React.createElement(Select,{components:{Input:CustomSelectInput},className:\"react-select\",classNamePrefix:\"react-select\",isMulti:true,name:\"form-field-name\",value:selectedOptions,onChange:setSelectedOptions,options:categories//   defaultValue={details.categories ? details.categories.map(item=>{\n//   return ({label:item, value:item})\n// }):\"\"}\n})),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(Label,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Status\"})),/*#__PURE__*/React.createElement(Select,{defaultValue:details.status?{label:'Active',value:'Active'}:{label:'Inactive',value:'Inactive'},components:{Input:CustomSelectInput},className:\"react-select\",classNamePrefix:\"react-select\",name:\"form-field-name\",options:statusOptions,onChange:function onChange(e){setformData(_objectSpread(_objectSpread({},formData),{},{status:e.value}));}})))),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return edit(details.id);},color:\"primary\"},\"Save Changes\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModal(false);}},\"Cancel\"))),/*#__PURE__*/React.createElement(Modal,{isOpen:modalBasic,toggle:function toggle(){return setModal(!modalBasic);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Delete\"})),/*#__PURE__*/React.createElement(ModalBody,null,\"Are you sure you want to delete attribute?\"),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:deleteVariant,color:\"primary\"},\"Confirm\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModalBasic(false);}},\"Cancel\"))),/*#__PURE__*/React.createElement(Modal,{isOpen:modalDelete,toggle:function toggle(){return setModal(!modalDelete);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Delete\"})),/*#__PURE__*/React.createElement(ModalBody,null,\"Are you sure you want to delete selected items?\"),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:deleteMultiple,color:\"primary\"},\"Confirm\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModalDelete(false);}},\"Cancel\")))));};export default Variant;","map":null,"metadata":{},"sourceType":"module"}