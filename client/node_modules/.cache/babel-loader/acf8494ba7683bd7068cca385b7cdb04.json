{"ast":null,"code":"import _objectSpread from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Row,Card,CardTitle,Label,FormGroup,Button}from'reactstrap';import{NavLink}from'react-router-dom';import{Formik,Form,Field}from'formik';import{connect}from'react-redux';import{Colxx}from'../../components/common/CustomBootstrap';import IntlMessages from'../../helpers/IntlMessages';import{forgotPassword}from'../../redux/actions';import{NotificationManager}from'../../components/common/react-notifications';import axios from\"axios\";import{reset}from'mousetrap';var validateEmail=function validateEmail(value){var error;if(!value){error='Please enter your email address';}else if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,4}$/i.test(value)){error='Invalid email address';}return error;};var ForgotPassword=function ForgotPassword(_ref){var history=_ref.history,forgotUserMail=_ref.forgotUserMail,loading=_ref.loading,error=_ref.error,forgotPasswordAction=_ref.forgotPasswordAction;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),response=_useState2[0],setResponse=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),formData=_useState4[0],setformData=_useState4[1];var styles={border:{border:\"2px solid green\"}};// SEND THE OTP\nvar SendOtp=function SendOtp(){console.log(formData);axios.post(\"/api/send-OTP\",formData).then(function(res){console.log(res.data);if(res.data.success){setResponse({email:res.data.email,otp:res.data.otp,expiration:res.data.expiration});NotificationManager.success(res.data.success,'Password Error',3000,null,null,'');}else if(res.data.error){NotificationManager.warning(res.data.error,'Password Error',3000,null,null,'');}});};var Reset=function Reset(e){e.preventDefault();if(!response.verified){localStorage.setItem(\"userEmail\",response.email);window.location.href=\"/user/reset-password\";}else{NotificationManager.warning(\"OTP not verified\",'OTP error',3000,null,null,'');}};// console.log(timenow);\n// if (response.expiration) {\n//   const exp = new Date(response.expiration)\n//   console.log(exp);\n//   if (exp.getTime() < timenow.getTime()) {\n//     console.log(true);\n//   }\n//   console.log(false);\n// }\n// RESEND THE PASSWORD\nvar resend=function resend(e){var timenow=new Date();console.log(timenow);var exp=new Date(response.expiration);// IF EXPIRY TIME HAS NOT CROSSED, THEN ERROR\nif(exp.getTime()>timenow.getTime()){NotificationManager.warning(\"OTP is still valid \",'OTP error',3000,null,null,'');console.log(formData);}else{// ELSE, RESEND INITIATED\nconsole.log(formData);axios.post(\"/send-OTP\",formData).then(function(res){console.log(res.data);if(res.data.success){setResponse({email:res.data.email,otp:res.data.otp,expiration:res.data.expiration});NotificationManager.warning(res.data.success,'Success',3000,null,null,'');}else if(res.data.error){NotificationManager.warning(res.data.error,'Error',3000,null,null,'');}});}};// useEffect(() => {\n//   if (error) {\n//     NotificationManager.warning(\n//       error,\n//       'Forgot Password Error',\n//       3000,\n//       null,\n//       null,\n//       ''\n//     );\n//   } else if (!loading && forgotUserMail === 'success')\n//     NotificationManager.success(\n//       'Please check your email.',\n//       'Forgot Password Success',\n//       3000,\n//       null,\n//       null,\n//       ''\n//     );\n// }, [error, forgotUserMail, loading]);\nreturn/*#__PURE__*/React.createElement(Row,{className:\"h-100\"},/*#__PURE__*/React.createElement(Colxx,{xxs:\"12\",md:\"10\",className:\"mx-auto my-auto\"},/*#__PURE__*/React.createElement(Card,{className:\"auth-card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"position-relative image-side \"},/*#__PURE__*/React.createElement(\"p\",{className:\"text-white h2\"},\"MAGIC IS IN THE DETAILS\"),/*#__PURE__*/React.createElement(\"p\",{className:\"white mb-0\"},\"Please use your e-mail to reset your password. \",/*#__PURE__*/React.createElement(\"br\",null),\"If you are not a member, please\",' ',/*#__PURE__*/React.createElement(NavLink,{to:\"/user/register\",className:\"white\"},\"register\"),\".\")),/*#__PURE__*/React.createElement(\"div\",{className:\"form-side\"},/*#__PURE__*/React.createElement(NavLink,{to:\"/\",className:\"white\"},/*#__PURE__*/React.createElement(\"span\",{className:\"logo-single\"})),/*#__PURE__*/React.createElement(CardTitle,{className:\"mb-4\"},/*#__PURE__*/React.createElement(IntlMessages,{id:\"user.forgot-password\"})),/*#__PURE__*/React.createElement(Formik,null,function(_ref2){var errors=_ref2.errors,touched=_ref2.touched;return/*#__PURE__*/React.createElement(Form,{className:\"av-tooltip tooltip-label-bottom\"},/*#__PURE__*/React.createElement(FormGroup,{className:\"form-group has-float-label\"},/*#__PURE__*/React.createElement(Label,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"user.email\"})),/*#__PURE__*/React.createElement(Field,{className:\"form-control\",name:\"email\",validate:validateEmail,onChange:function onChange(e){setformData({email:e.target.value});}})),response.otp?/*#__PURE__*/React.createElement(FormGroup,{className:\"form-group has-float-label\"},/*#__PURE__*/React.createElement(Label,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"OTP\"})),/*#__PURE__*/React.createElement(Field,{className:\"form-control\",name:\"Otp\",validate:validateEmail,onChange:function onChange(e){if(e.target.value==response.otp){setResponse(_objectSpread(_objectSpread({},response),{},{verified:false}));NotificationManager.success(\"OTP verified\",'Success',3000,null,null,'');}else if(e.target.value.length==4&&e.target.value!=response.otp){setResponse(_objectSpread(_objectSpread({},response),{},{verified:true}));NotificationManager.warning(\"Incorrect OTP\",'Error',3000,null,null,'');}}})):\"\",/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-between align-items-center\"},response.otp?/*#__PURE__*/React.createElement(\"div\",{style:{cursor:'pointer'},onClick:resend},\"Resend\"):\"\",response.otp?/*#__PURE__*/React.createElement(Button,{onClick:Reset,color:\"primary\",className:\"btn-shadow btn-multiple-state \".concat(loading?'show-spinner':''),size:\"lg\"},/*#__PURE__*/React.createElement(\"span\",{className:\"spinner d-inline-block\"},/*#__PURE__*/React.createElement(\"span\",{className:\"bounce1\"}),/*#__PURE__*/React.createElement(\"span\",{className:\"bounce2\"}),/*#__PURE__*/React.createElement(\"span\",{className:\"bounce3\"})),/*#__PURE__*/React.createElement(\"span\",{className:\"label\"},\"Reset\")):/*#__PURE__*/React.createElement(Button,{onClick:SendOtp,color:\"primary\",className:\"btn-shadow btn-multiple-state \".concat(loading?'show-spinner':''),size:\"lg\"},/*#__PURE__*/React.createElement(\"span\",{className:\"spinner d-inline-block\"},/*#__PURE__*/React.createElement(\"span\",{className:\"bounce1\"}),/*#__PURE__*/React.createElement(\"span\",{className:\"bounce2\"}),/*#__PURE__*/React.createElement(\"span\",{className:\"bounce3\"})),/*#__PURE__*/React.createElement(\"span\",{className:\"label\"},\"Send OTP\"))));})))));};var mapStateToProps=function mapStateToProps(_ref3){var authUser=_ref3.authUser;var forgotUserMail=authUser.forgotUserMail,loading=authUser.loading,error=authUser.error;return{forgotUserMail:forgotUserMail,loading:loading,error:error};};export default connect(mapStateToProps,{forgotPasswordAction:forgotPassword})(ForgotPassword);","map":null,"metadata":{},"sourceType":"module"}