{"ast":null,"code":"import _toConsumableArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _createForOfIteratorHelper from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Button,Modal,ModalHeader,ModalBody,ModalFooter,Label,CustomInput}from'reactstrap';import axios from'axios';import{Link}from'react-router-dom';import useMousetrap from'../../../../hooks/use-mousetrap';import IntlMessages from'../../../../helpers/IntlMessages';import CustomersListHeading from'./CustomersListHeading';import CustomersPageListing from'./CustomersPageListing';import CustomersPageHeading from'./CustomersPageHeading';import sample from'../../inventory/common/sample.csv';import{NotificationManager}from'../../../../components/common/react-notifications';var getIndex=function getIndex(value,arr,prop){for(var i=0;i<arr.length;i+=1){if(arr[i][prop]===value){return i;}}return-1;};var orderOptions=[{label:'Id',column:'id'},{label:'Name',column:'firstName'},{label:'Email',column:'email'},{label:'Orders Count',column:'orderCount'}];var mannerOptions=[{label:'Ascending',value:'ASC'},{label:'Descending',value:'DESC'}];//const pageSizes = [4, 8, 12, 20];\nvar pageSizes=[15,50,100,150,200];var Customers=function Customers(_ref){var match=_ref.match;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoaded=_useState2[0],setIsLoaded=_useState2[1];var _useState3=useState('thumblist'),_useState4=_slicedToArray(_useState3,2),displayMode=_useState4[0],setDisplayMode=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),currentPage=_useState6[0],setCurrentPage=_useState6[1];var _useState7=useState(15),_useState8=_slicedToArray(_useState7,2),selectedPageSize=_useState8[0],setSelectedPageSize=_useState8[1];var _useState9=useState({column:'title',label:'Category Name'}),_useState10=_slicedToArray(_useState9,2),selectedOrderOption=_useState10[0],setSelectedOrderOption=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),modalBasic=_useState12[0],setModalBasic=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),modalOpen=_useState14[0],setModalOpen=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),totalItemCount=_useState16[0],setTotalItemCount=_useState16[1];var _useState17=useState(1),_useState18=_slicedToArray(_useState17,2),totalPage=_useState18[0],setTotalPage=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),selectedItems=_useState20[0],setSelectedItems=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),items=_useState22[0],setItems=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),lastChecked=_useState24[0],setLastChecked=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),modal=_useState26[0],setModal=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),change=_useState28[0],setchange=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),modalDelete=_useState30[0],setModalDelete=_useState30[1];var _useState31=useState(0),_useState32=_slicedToArray(_useState31,2),customerId=_useState32[0],setCustomerId=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),importing=_useState34[0],setImporting=_useState34[1];var _useState35=useState(false),_useState36=_slicedToArray(_useState35,2),importModal=_useState36[0],setImportModal=_useState36[1];var _useState37=useState(null),_useState38=_slicedToArray(_useState37,2),importFile=_useState38[0],setImportFile=_useState38[1];var _useState39=useState(''),_useState40=_slicedToArray(_useState39,2),searchItem=_useState40[0],setSearchItem=_useState40[1];var _useState41=useState({label:'Id',column:'id'}),_useState42=_slicedToArray(_useState41,2),orderBy=_useState42[0],setOrderBy=_useState42[1];var _useState43=useState({label:'Ascending',value:'ASC'}),_useState44=_slicedToArray(_useState43,2),orderManner=_useState44[0],setOrderManner=_useState44[1];useEffect(function(){setCurrentPage(1);},[selectedPageSize,selectedOrderOption]);var getCustomers=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"/api/customers/\".concat(currentPage,\"?pageSize=\").concat(selectedPageSize,\"&orderBy=\").concat(orderBy.column,\"&searchItem=\").concat(searchItem,\"&orderManner=\").concat(orderManner.value));case 3:_yield$axios$get=_context.sent;data=_yield$axios$get.data;console.log(data);setItems(data.customers);setTotalItemCount(data.count);setTotalPage(Math.ceil(data.count/selectedPageSize));setSelectedItems([]);setIsLoaded(true);NotificationManager.success(\"Customer Details Fetched!!!\",'Success',3000);_context.next=19;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.log(_context.t0);NotificationManager.error(\"Something Went Wrong!!!\",'Error',3000);setIsLoaded(true);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function getCustomers(){return _ref2.apply(this,arguments);};}();useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getCustomers();case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},_callee2);}))();},[change]);// Function to call for importing Customers\nvar importCustomers=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var data,config,_iterator,_step,pair,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(importFile){_context3.next=2;break;}return _context3.abrupt(\"return\",NotificationManager.error(\"Select File to Import...\",'Error',3000,null,null,''));case 2:data=new FormData();// Update the formData object\ndata.append(\"importFile\",importFile);config={headers:{'content-type':'multipart/form-data'}};_iterator=_createForOfIteratorHelper(data.entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){pair=_step.value;console.log(pair[0],\" : \",pair[1]);}// Request made to the backend api\n// Send formData object\n}catch(err){_iterator.e(err);}finally{_iterator.f();}_context3.prev=7;setImporting(true);_context3.next=11;return axios.post('/api/customers/import',data,config);case 11:res=_context3.sent;setImporting(false);setchange(!change);setImportModal(false);NotificationManager.success(res.data,'Success',3000,null,null,'');_context3.next=23;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](7);console.log(_context3.t0);setImporting(false);NotificationManager.error(\"Something Wrong With CSV\",'Error',3000,null,null,'');case 23:case\"end\":return _context3.stop();}}},_callee3,null,[[7,18]]);}));return function importCustomers(){return _ref4.apply(this,arguments);};}();//DELETE CUSTOMER HANDLER\nvar deleteModal=function deleteModal(e){setCustomerId(e);setModalBasic(true);};// DELETE CUSTOMER API CALL\nvar deleteCustomer=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return axios.post(\"/api/customers/delete?id=\".concat(customerId));case 3:setchange(!change);setModalBasic(false);NotificationManager.success('Customer Deleted Successfully.','Success',3000);_context4.next=11;break;case 8:_context4.prev=8;_context4.t0=_context4[\"catch\"](0);NotificationManager.error('Something Went Wrong!!!','Error',3000);case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[0,8]]);}));return function deleteCustomer(){return _ref5.apply(this,arguments);};}();// DELETE MULTIPLE CUSTOMERS\nvar deleteMultiple=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(selectedItems);_context5.prev=1;_context5.next=4;return axios.post(\"/api/customers/delete\",null,{params:{id:selectedItems}});case 4:setchange(!change);setModalDelete(false);NotificationManager.success('Customer(s) Deleted Successfully.','Success',3000,null,null,'');_context5.next=14;break;case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](1);console.log(_context5.t0);setModalDelete(false);NotificationManager.error('Something Went Wrong!!!','Error',3000,null,null,'');case 14:case\"end\":return _context5.stop();}}},_callee5,null,[[1,9]]);}));return function deleteMultiple(){return _ref6.apply(this,arguments);};}();var onCheckItem=function onCheckItem(event,id){if(event.target.tagName==='A'||event.target.parentElement&&event.target.parentElement.tagName==='A'){return true;}if(lastChecked===null){setLastChecked(id);}var selectedList=_toConsumableArray(selectedItems);if(selectedList.includes(id)){selectedList=selectedList.filter(function(x){return x!==id;});}else{selectedList.push(id);}setSelectedItems(selectedList);if(event.shiftKey){var newItems=_toConsumableArray(items);var start=getIndex(id,newItems,'id');var end=getIndex(lastChecked,newItems,'id');newItems=newItems.slice(Math.min(start,end),Math.max(start,end)+1);selectedItems.push.apply(selectedItems,_toConsumableArray(newItems.map(function(item){return item.id;})));selectedList=Array.from(new Set(selectedItems));setSelectedItems(selectedList);}document.activeElement.blur();return false;};var handleChangeSelectAll=function handleChangeSelectAll(isToggle){if(selectedItems.length>=items.length){if(isToggle){setSelectedItems([]);}}else{setSelectedItems(items.map(function(x){return x.id;}));}document.activeElement.blur();return false;};var onContextMenuClick=function onContextMenuClick(e,data){// params : (e,data,target)\nconsole.log('onContextMenuClick - selected items',selectedItems);console.log('onContextMenuClick - action : ',data.action);};var changePage=function changePage(i){setCurrentPage(i);axios.get(\"/api/customers/\".concat(i,\"?pageSize=\").concat(selectedPageSize,\"&orderBy=\").concat(orderBy.column,\"&orderManner=\").concat(orderManner.value,\"&searchItem=\").concat(searchItem)).then(function(res){setItems(res.data.customers);setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/selectedPageSize));setSelectedItems([]);setIsLoaded(true);});};var onchangePagesize=function onchangePagesize(size){setCurrentPage(1);setSelectedPageSize(size);axios.get(\"/api/customers/\".concat(1,\"?pageSize=\",size,\"&orderBy=\").concat(orderBy.column,\"&orderManner=\").concat(orderManner.value,\"&searchItem=\").concat(searchItem)).then(function(res){setItems(res.data.customers);setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/size));setSelectedItems([]);setIsLoaded(true);});};var onContextMenu=function onContextMenu(e,data){var clickedCategoryId=data.data;if(!selectedItems.includes(clickedCategoryId)){setSelectedItems([clickedCategoryId]);}return true;};useMousetrap(['ctrl+a','command+a'],function(){handleChangeSelectAll(false);});useMousetrap(['ctrl+d','command+d'],function(){setSelectedItems([]);return false;});var startIndex=(currentPage-1)*selectedPageSize;var endIndex=currentPage*selectedPageSize;return!isLoaded?/*#__PURE__*/React.createElement(\"div\",{className:\"loading\"}):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"disable-text-selection\"},/*#__PURE__*/React.createElement(CustomersPageHeading,{setModalDelete:setModalDelete,heading:\"Customers\",addUrl:\"/app/customers/add-customer\",displayMode:displayMode,changeDisplayMode:setDisplayMode,handleChangeSelectAll:handleChangeSelectAll,orderBy:orderBy,orderManner:orderManner,changeOrderBy:/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(ord){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:setOrderBy(ord);setCurrentPage(1);axios.get(\"/api/customers/\".concat(1,\"?pageSize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(ord.column,\"&orderManner=\").concat(orderManner.value)).then(function(res){setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/selectedPageSize));setItems(res.data.customers);// setTotalItemCount(data.totalItem);\n});case 3:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x){return _ref7.apply(this,arguments);};}(),changeOrderManner:/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(mann){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:setOrderManner(mann);setCurrentPage(1);axios.get(\"/api/customers/\".concat(1,\"?pageSize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(orderBy.column,\"&orderManner=\").concat(mann.value)).then(function(res){setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/selectedPageSize));setItems(res.data.customers);// setTotalItemCount(data.totalItem);\n});case 3:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x2){return _ref8.apply(this,arguments);};}(),onSearchKey:/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(e){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(e.key==='Enter');if(e.key==='Enter'){setSearchItem(e.target.value);axios.get(\"/api/customers/\".concat(1,\"?pageSize=\",selectedPageSize,\"&searchItem=\").concat(e.target.value,\"&orderBy=\").concat(orderBy.column,\"&orderManner=\").concat(orderManner.value)).then(function(res){setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/selectedPageSize));setItems(res.data.customers);// setTotalItemCount(data.totalItem);\n}).catch(function(err){console.log(JSON.stringify(err,null,4));if(err.message.slice(err.message.indexOf('status code '))==='status code 404')return NotificationManager.info('No Search Result Found.','Not Found',3000);else NotificationManager.info('Something Went Wrong!!!');});}case 2:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x3){return _ref9.apply(this,arguments);};}(),onchangepagesize:onchangePagesize,selectedPageSize:selectedPageSize,totalItemCount:totalItemCount,selectedOrderOption:selectedOrderOption,match:match,startIndex:startIndex,endIndex:endIndex,selectedItemsLength:selectedItems?selectedItems.length:0,itemsLength:items?items.length:0,orderOptions:orderOptions,mannerOptions:mannerOptions,pageSizes:pageSizes,toggleModal:function toggleModal(){return setModalOpen(!modalOpen);},setImportModal:setImportModal}),items.length==0?\"\":/*#__PURE__*/React.createElement(CustomersListHeading,{selectedItemsLength:selectedItems?selectedItems.length:0,handleChangeSelectAll:handleChangeSelectAll,itemsLength:items?items.length:0,orderManner:orderManner,orderBy:orderBy,changeOrderBy:/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(ord){var ind;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:setOrderBy(ord);setCurrentPage(1);if(orderBy.column===ord.column){ind=!mannerOptions.findIndex(function(man){return man.value===orderManner.value;});setOrderManner(mannerOptions[ind?1:0]);axios.get(\"/api/customers/\".concat(1,\"?pagesize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(ord.column,\"&orderManner=\").concat(mannerOptions[ind?1:0].value)).then(function(res){setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/selectedPageSize));setItems(res.data.customers);// setTotalItemCount(data.totalItem);\n});}else{setOrderManner(mannerOptions[0]);axios.get(\"/api/customers/\".concat(1,\"?pagesize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(ord.column,\"&orderManner=\").concat(mannerOptions[0].value)).then(function(res){setTotalItemCount(res.data.count);setTotalPage(Math.ceil(res.data.count/selectedPageSize));setItems(res.data.customers);// setTotalItemCount(data.totalItem);\n});}case 3:case\"end\":return _context9.stop();}}},_callee9);}));return function(_x4){return _ref10.apply(this,arguments);};}()}),items.length==0?/*#__PURE__*/React.createElement(\"h3\",null,\"No Records found\"):/*#__PURE__*/React.createElement(CustomersPageListing,{items:items,displayMode:displayMode,selectedItems:selectedItems,onCheckItem:onCheckItem,currentPage:currentPage,totalPage:totalPage,onContextMenuClick:onContextMenuClick,onContextMenu:onContextMenu,onChangePage:changePage,pagesize:selectedPageSize,setModalBasic:setModalBasic,deleteModal:deleteModal}),/*#__PURE__*/React.createElement(Modal,{isOpen:modalBasic,toggle:function toggle(){return setModal(!modalBasic);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Delete\"})),/*#__PURE__*/React.createElement(ModalBody,null,\"Are you sure you want to delete Customer?\"),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:deleteCustomer,color:\"primary\"},\"Confirm\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModalBasic(false);}},\"Cancel\"))),/*#__PURE__*/React.createElement(Modal,{isOpen:modalDelete,toggle:function toggle(){return setModal(!modalDelete);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Delete\"})),/*#__PURE__*/React.createElement(ModalBody,null,\"Are you sure you want to delete selected items?\"),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:deleteMultiple,color:\"primary\"},\"Confirm\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModalDelete(false);}},\"Cancel\")))),/*#__PURE__*/React.createElement(Modal,{isOpen:importModal,toggle:function toggle(){return setImportModal(!importModal);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Add Customers by importing CSV file.\"})),/*#__PURE__*/React.createElement(ModalBody,null,/*#__PURE__*/React.createElement(Label,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Select csv File to Import\"})),/*#__PURE__*/React.createElement(CustomInput,{type:\"file\",accept:\".csv\",onChange:function onChange(event){setImportFile(event.target.files[0]);},id:\"exampleCustomFileBrowser3\",name:\"customFile\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12 mt-3 text-right\"},/*#__PURE__*/React.createElement(Link,{className:\"h6 text-primary\",to:sample,target:\"_blank\",download:\"sample.csv\"},\"Sample CSV \",/*#__PURE__*/React.createElement(\"i\",{className:\"iconsminds-data-download\"})))),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(\"div\",null,!importing?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{onClick:importCustomers,color:\"primary\"},\"Import\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setImportModal(false);}},\"Cancel\")):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"h4\",null,\"Importing!!!\"),/*#__PURE__*/React.createElement(\"h4\",null,\"Please Wait...\"))))));};export default Customers;","map":null,"metadata":{},"sourceType":"module"}