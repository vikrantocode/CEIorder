{"ast":null,"code":"import _toConsumableArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/browsewire/Desktop/CEI/cei/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import{servicePath}from'../../../../constants/defaultValues';import useMousetrap from'../../../../hooks/use-mousetrap';import ProductListHeading from'./ProductListHeadings';import ProductPageListing from'./ProductPageListing';import{useHistory}from'react-router-dom';import{Button,Modal,ModalHeader,ModalBody,ModalFooter}from'reactstrap';import{NotificationManager}from'../../../../components/common/react-notifications';import IntlMessages from'../../../../helpers/IntlMessages';import ProductPageHeading from'./ProductPageHeading';var getIndex=function getIndex(value,arr,prop){for(var i=0;i<arr.length;i+=1){if(arr[i][prop]===value){return i;}}return-1;};var orderOptions=[{column:'name',label:'Product Name'},{column:'SKU',label:'SKU'},{column:'retailPrice',label:'Cost'}];var pageSizes=[15,30,60,200];var orderManners=[{value:'ASC',label:'Ascending'},{value:'DESC',label:'Descending'}];var Product=function Product(_ref){var match=_ref.match;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoaded=_useState2[0],setIsLoaded=_useState2[1];var _useState3=useState('thumblist'),_useState4=_slicedToArray(_useState3,2),displayMode=_useState4[0],setDisplayMode=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),currentPage=_useState6[0],setCurrentPage=_useState6[1];var _useState7=useState(15),_useState8=_slicedToArray(_useState7,2),selectedPageSize=_useState8[0],setSelectedPageSize=_useState8[1];var _useState9=useState({column:'title',label:'Product Name'}),_useState10=_slicedToArray(_useState9,2),selectedOrderOption=_useState10[0],setSelectedOrderOption=_useState10[1];var _React$useState=React.useState({}),_React$useState2=_slicedToArray(_React$useState,2),formData=_React$useState2[0],setformData=_React$useState2[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),modalBasic=_useState12[0],setModalBasic=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),modalOpen=_useState14[0],setModalOpen=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),totalItemCount=_useState16[0],setTotalItemCount=_useState16[1];var _useState17=useState(1),_useState18=_slicedToArray(_useState17,2),totalPage=_useState18[0],setTotalPage=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),selectedItems=_useState20[0],setSelectedItems=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),items=_useState22[0],setItems=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),lastChecked=_useState24[0],setLastChecked=_useState24[1];var _useState25=useState(''),_useState26=_slicedToArray(_useState25,2),productId=_useState26[0],setproductId=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),modalDelete=_useState28[0],setModalDelete=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),change=_useState30[0],setchange=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),importModal=_useState32[0],setImportModal=_useState32[1];var _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),data=_useState34[0],setData=_useState34[1];var _useState35=useState(null),_useState36=_slicedToArray(_useState35,2),importFile=_useState36[0],setImportFile=_useState36[1];var _useState37=useState(false),_useState38=_slicedToArray(_useState37,2),importing=_useState38[0],setImporting=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),processingFile=_useState40[0],setProcessingFile=_useState40[1];var history=useHistory();var _useState41=useState(''),_useState42=_slicedToArray(_useState41,2),searchItem=_useState42[0],setSearchItem=_useState42[1];var _useState43=useState({column:'id',label:'Id'}),_useState44=_slicedToArray(_useState43,2),order=_useState44[0],setOrder=_useState44[1];var _useState45=useState({value:'ASC',label:'Ascending'}),_useState46=_slicedToArray(_useState45,2),manner=_useState46[0],setManner=_useState46[1];var _useState47=useState([]),_useState48=_slicedToArray(_useState47,2),brand=_useState48[0],setbrand=_useState48[1];var _useState49=useState([]),_useState50=_slicedToArray(_useState49,2),filterdata=_useState50[0],setfilterdata=_useState50[1];var _useState51=useState('default'),_useState52=_slicedToArray(_useState51,2),status=_useState52[0],setStatus=_useState52[1];var _useState53=useState(false),_useState54=_slicedToArray(_useState53,2),modal=_useState54[0],setModal=_useState54[1];var brandid=[];var _useState55=useState(false),_useState56=_slicedToArray(_useState55,2),filterOptionsopen=_useState56[0],setfilterOptionsopen=_useState56[1];//const [brandsId, setbrandsId] = useState([]);\n// To Open Delete Modal\nvar deleteMultipleModal=function deleteMultipleModal(e){setModalDelete(true);};var deleteModal=function deleteModal(e){setproductId(e);setModalBasic(true);};// DELETE MULTIPLE PRODUCTS\nvar deleteMultiple=function deleteMultiple(){axios.post('/api/inventory/delete-test',null,{params:{id:selectedItems}}).then(function(res){console.log(res.data);setchange(!change);setModalDelete(false);NotificationManager.success(res.data.success,'Success',3000,null,null,'');});};//DELETE PRODUCT HANDLER\nvar deleteproduct=function deleteproduct(e){axios.post('/api/inventory/delete-product',null,{params:{id:productId}}).then(function(res){setchange(!change);setModalBasic(false);NotificationManager.success(res.data.success,'Success',3000,null,null,'');});};useEffect(function(){setCurrentPage(1);},[selectedPageSize,selectedOrderOption]);var importProducts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _data,config,_iterator,_step,pair,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(formData.vendorId&&importFile)){_context.next=24;break;}_data=new FormData();// Update the formData object\n_data.append('vendorId',formData.vendorId);_data.append('importFile',importFile);config={headers:{'content-type':'multipart/form-data'}};// Details of the uploaded file\nconsole.log(importFile);_iterator=_createForOfIteratorHelper(_data.entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){pair=_step.value;console.log(pair[0],' : ',pair[1]);}// Request made to the backend api\n// Send formData object\n}catch(err){_iterator.e(err);}finally{_iterator.f();}_context.prev=8;setImporting(true);_context.next=12;return axios.post('/api/inventory/import-products',_data,config);case 12:res=_context.sent;if(res.status===201){setImporting(false);setchange(!change);setImportModal(false);NotificationManager.success(res.data.success,'Success',3000,null,null,'');}else{setImporting(false);NotificationManager.error(res.data.error,'Error',3000,null,null,'');}console.log(res);_context.next=22;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](8);console.log(_context.t0);setImporting(false);NotificationManager.error(\"Something Wrong With CSV\",'Error',3000,null,null,'');case 22:_context.next=25;break;case 24:NotificationManager.error(\"Select Vendor and File to Import...\",'Error',3000,null,null,'');case 25:case\"end\":return _context.stop();}}},_callee,null,[[8,17]]);}));return function importProducts(){return _ref2.apply(this,arguments);};}();////filter data\nvar filter=function filter(filterdata){var _filterdata$itemNumbe,_filterdata$brandId,_filterdata$vendor,_filterdata$productCa;setfilterdata(filterdata);setStatus('processing');brandid=[];console.log(filterdata);if(((_filterdata$itemNumbe=filterdata.itemNumber)===null||_filterdata$itemNumbe===void 0?void 0:_filterdata$itemNumbe.length)>0||((_filterdata$brandId=filterdata.brandId)===null||_filterdata$brandId===void 0?void 0:_filterdata$brandId.length)>0||((_filterdata$vendor=filterdata.vendor)===null||_filterdata$vendor===void 0?void 0:_filterdata$vendor.length)>0||((_filterdata$productCa=filterdata.productCategory)===null||_filterdata$productCa===void 0?void 0:_filterdata$productCa.length)>0){axios.post(\"/api/inventory/filterProduct/\".concat(currentPage,\"/?pagesize=\").concat(selectedPageSize),filterdata).then(function(res){return res.data;}).then(function(data){setStatus('processing');setTotalPage(data.totalPage);console.log(data.data);data.data.map(function(x){return!brandid.includes(x.brandId)?brandid.push(x.brandId):null;});axios.get(\"/api/inventory/getBrand?id=\".concat(brandid)).then(function(res){var _res$data$data,_data$data;console.log(res);setbrand((_res$data$data=res.data.data)===null||_res$data$data===void 0?void 0:_res$data$data.map(function(x){return _objectSpread({},x);}));setItems((_data$data=data.data)===null||_data$data===void 0?void 0:_data$data.map(function(x){return _objectSpread({},x);}));setIsLoaded(true);setStatus('success');});setSelectedItems([]);setTotalItemCount(data.totalItem);}).catch(function(err){setStatus('fail');}).finally(function(){setTimeout(function(){setStatus('default');//setMessageShow(false);\n},3000);});}else{setStatus('default');}};function fetchData(_x){return _fetchData.apply(this,arguments);}// Fetching products via axios call\nfunction _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(filterOptionsIsOpen){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:setfilterOptionsopen(filterOptionsIsOpen);//if(Object.getOwnPropertyNames(filterdata).length <= 1){\naxios.get(\"/api/inventory/get-products/\".concat(currentPage,\"?searchItem=\").concat(searchItem,\"&pagesize=\").concat(selectedPageSize,\"&orderBy=\").concat(order.column,\"&orderManner=\").concat(manner.value)).then(function(res){return res.data;}).then(function(data){setTotalPage(data.totalPage);console.log(data.data);setItems(data.data.map(function(x){return _objectSpread({},x);}));data.data.map(function(x){return!brandid.includes(x.brandId)?brandid.push(x.brandId):null;});setSelectedItems([]);setTotalItemCount(data.totalItem);}).then(function(){axios.get(\"/api/inventory/getBrand?id=\".concat(brandid)).then(function(res){var _res$data$data2;setbrand((_res$data$data2=res.data.data)===null||_res$data$data2===void 0?void 0:_res$data$data2.map(function(x){return _objectSpread({},x);}));setIsLoaded(true);});});// }\ncase 2:case\"end\":return _context6.stop();}}},_callee6);}));return _fetchData.apply(this,arguments);}useEffect(function(){//fetchData();\nconsole.log(Object.getOwnPropertyNames(filterdata));if(Object.getOwnPropertyNames(filterdata).length>1){filter(filterdata);console.log('full');console.log(filterdata);}else{console.log('empty');fetchData();}},[change]);var EditProduct=function EditProduct(e){localStorage.setItem('productId',e);history.push('/app/inventory/products/edit');};// EDIT HANDLER\nvar edit=function edit(e){console.log(e);axios.post('/api/edit-user',formData,{params:{id:e}}).then(function(res){console.log(res);if(res.data.success){setModal(false);NotificationManager.success(res.data.success,'Success',3000,null,null,'');window.location.reload();}});};// When check an product item.\nvar onCheckItem=function onCheckItem(event,id){console.log(id);console.log(selectedItems);if(event.target.tagName==='A'||event.target.parentElement&&event.target.parentElement.tagName==='A'){return true;}if(lastChecked===null){setLastChecked(id);}var selectedList=_toConsumableArray(selectedItems);if(selectedList.includes(id)){selectedList=selectedList.filter(function(x){return x!==id;});}else{selectedList.push(id);}setSelectedItems(selectedList);if(event.shiftKey){var newItems=_toConsumableArray(items);var start=getIndex(id,newItems,'id');var end=getIndex(lastChecked,newItems,'id');newItems=newItems.slice(Math.min(start,end),Math.max(start,end)+1);selectedItems.push.apply(selectedItems,_toConsumableArray(newItems.map(function(item){return item.id;})));selectedList=Array.from(new Set(selectedItems));setSelectedItems(selectedList);}document.activeElement.blur();return false;};// Bulk Selection handler.\nvar handleChangeSelectAll=function handleChangeSelectAll(isToggle){if(selectedItems.length>=items.length){if(isToggle){setSelectedItems([]);}}else{setSelectedItems(items.map(function(x){return x.id;}));}document.activeElement.blur();console.log(selectedItems);return false;};var onContextMenuClick=function onContextMenuClick(e,data){// params : (e,data,target)\nconsole.log('onContextMenuClick - selected items',selectedItems);console.log('onContextMenuClick - action : ',data.action);};var onContextMenu=function onContextMenu(e,data){var clickedProductId=data.data;if(!selectedItems.includes(clickedProductId)){setSelectedItems([clickedProductId]);}return true;};useMousetrap(['ctrl+a','command+a'],function(){handleChangeSelectAll(false);});useMousetrap(['ctrl+d','command+d'],function(){setSelectedItems([]);return false;});var startIndex=(currentPage-1)*selectedPageSize;var endIndex=currentPage*selectedPageSize;var handleUpload=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(data.length){_context2.next=2;break;}return _context2.abrupt(\"return\",NotificationManager.info('Select CSV file first','Warning',3000,null,null,''));case 2:setImporting(true);_context2.prev=3;_context2.next=6;return axios.post('/api/inventory/add-products',{data:data});case 6:res=_context2.sent;console.log(res);NotificationManager.success(res.data.success,'Success',3000,null,null,'');setchange(!change);setImporting(false);setImportModal(false);_context2.next=19;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](3);console.log(_context2.t0);NotificationManager.error('Something wrong with CSV','Error',3000,null,null,'');setImporting(false);case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[3,14]]);}));return function handleUpload(){return _ref3.apply(this,arguments);};}();return!isLoaded?/*#__PURE__*/React.createElement(\"div\",{className:\"loading\"}):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"disable-text-selection\"},/*#__PURE__*/React.createElement(ProductPageHeading,{filter:filter,status:status,fetchData:fetchData,setfilterdata:setfilterdata//brandsre={setbrandsId}\n,processingFile:processingFile,setProcessingFile:setProcessingFile,importing:importing,setData:setData,setItems:setItems,heading:\"Products\",addUrl:\"/app/inventory/add-new-product\",displayMode:displayMode,changeDisplayMode:setDisplayMode,handleChangeSelectAll:handleChangeSelectAll,handleUpload:handleUpload,changeOrderBy:/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ord){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setOrder(ord);axios.get(\"/api/inventory/get-products/\".concat(1,\"?pagesize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(ord.column,\"&orderManner=\").concat(manner.value)).then(function(res){setTotalItemCount(res.data.totalItem);setTotalPage(res.data.totalPage);setItems(res.data.data.map(function(x){return _objectSpread({},x);}));// setTotalItemCount(data.totalItem);\n});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref4.apply(this,arguments);};}(),changeOrderManner:/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(man){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setManner(man);axios.get(\"/api/inventory/get-products/\".concat(1,\"?pagesize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(order.column,\"&orderManner=\").concat(man.value)).then(function(res){setTotalItemCount(res.data.totalItem);setTotalPage(res.data.totalPage);setItems(res.data.data.map(function(x){return _objectSpread({},x);}));// setTotalItemCount(data.totalItem);\n});case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x3){return _ref5.apply(this,arguments);};}(),changePageSize:setSelectedPageSize,selectedPageSize:selectedPageSize,totalItemCount:totalItemCount,selectedOrderOption:selectedOrderOption,match:match,startIndex:startIndex,endIndex:endIndex,change:change,setchange:setchange,selectedItemsLength:selectedItems?selectedItems.length:0,itemsLength:items?items.length:0,onSearchKey:function onSearchKey(e){if(e.key==='Enter'){setSearchItem(e.target.value);axios.get(\"/api/inventory/get-products/1?pagesize=\".concat(selectedPageSize,\"&searchItem=\").concat(e.target.value,\"&orderBy=\").concat(order.column,\"&orderManner=\").concat(manner.value)).then(function(res){setTotalItemCount(res.data.totalItem);setTotalPage(res.data.totalPage);setItems(res.data.data.map(function(x){return _objectSpread({},x);}));});}},orderOptions:orderOptions,pageSizes:pageSizes,toggleModal:function toggleModal(){return setModalOpen(!modalOpen);},deleteMultipleModal:deleteMultipleModal,importModal:importModal,setImportModal:setImportModal,setImportFile:setImportFile,importProducts:importProducts,formData:formData,setformData:setformData,order:order,manner:manner}),items.length==0?'':/*#__PURE__*/React.createElement(ProductListHeading,{selectedItemsLength:selectedItems?selectedItems.length:0,handleChangeSelectAll:handleChangeSelectAll,itemsLength:items?items.length:0,manner:manner,order:order,changeOrderBy:/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(ord){var ind;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setOrder(ord);if(order.column===ord.column){ind=!orderManners.findIndex(function(man){return man.value===manner.value;});setManner(orderManners[ind?1:0]);axios.get(\"/api/inventory/get-products/\".concat(1,\"?pagesize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(ord.column,\"&orderManner=\").concat(orderManners[ind?1:0].value)).then(function(res){setTotalItemCount(res.data.totalItem);setTotalPage(res.data.totalPage);setItems(res.data.data.map(function(x){return _objectSpread({},x);}));// setTotalItemCount(data.totalItem);\n});}else{setManner(orderManners[0]);axios.get(\"/api/inventory/get-products/\".concat(1,\"?pagesize=\",selectedPageSize,\"&searchItem=\").concat(searchItem,\"&orderBy=\").concat(ord.column,\"&orderManner=\").concat(orderManners[0].value)).then(function(res){setTotalItemCount(res.data.totalItem);setTotalPage(res.data.totalPage);setItems(res.data.data.map(function(x){return _objectSpread({},x);}));// setTotalItemCount(data.totalItem);\n});}case 2:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x4){return _ref6.apply(this,arguments);};}()}),items.length==0?/*#__PURE__*/React.createElement(\"h3\",null,\"No Records Found\"):/*#__PURE__*/React.createElement(ProductPageListing// {...console.log(brand,\"ooooooooooooooooooooooooooooooooooooooooo\")}\n,{items:items,brand:brand,deleteModal:deleteModal,displayMode:displayMode,selectedItems:selectedItems,onCheckItem:onCheckItem,currentPage:currentPage,totalPage:totalPage,onContextMenuClick:onContextMenuClick,onContextMenu:onContextMenu,onChangePage:setCurrentPage,EditProduct:EditProduct,setchange:setchange,change:change}),/*#__PURE__*/React.createElement(Modal,{isOpen:modalBasic,toggle:function toggle(){return setModal(!modalBasic);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Delete\"})),/*#__PURE__*/React.createElement(ModalBody,null,\"Are you sure you want to delete Product?\"),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:deleteproduct,color:\"primary\"},\"Confirm\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModalBasic(false);}},\"Cancel\"))),/*#__PURE__*/React.createElement(Modal,{isOpen:modalDelete,toggle:function toggle(){return setModal(!modalDelete);}},/*#__PURE__*/React.createElement(ModalHeader,null,/*#__PURE__*/React.createElement(IntlMessages,{id:\"Delete\"})),/*#__PURE__*/React.createElement(ModalBody,null,\"Are you sure you want to delete selected items?\"),/*#__PURE__*/React.createElement(ModalFooter,null,/*#__PURE__*/React.createElement(Button,{onClick:deleteMultiple,color:\"primary\"},\"Confirm\"),' ',/*#__PURE__*/React.createElement(Button,{color:\"secondary\",onClick:function onClick(){return setModalDelete(false);}},\"Cancel\")))));};export default Product;","map":null,"metadata":{},"sourceType":"module"}